<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>EAR: Tables</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../logo_small.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">EAR
   &#160;<span id="projectnumber">4.2.1</span>
   </div>
   <div id="projectbrief">EAR Reference Manual</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Tables </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h3>Application information</h3>
<p>The following tables contain information directly related to applications executed on the system while EAR was monitoring. The main key is the JOBID.STEPID combination generated by the scheduler.</p>
<ul>
<li><b>Jobs</b>: job information (app_id, user_id, job_id, step_id, etc). One record per JOBID.STEPID is created in the DB.</li>
<li><b>Applications</b>: this table's records serve as a link between Jobs and Signatures, providing an application signature (from EARL) for each node of a job. One record per JOBID.STEPID.NODENAME is created in the DB.</li>
<li><b>Loops</b>: similar to <em>Applications</em>, but stores a Signature for each application loop detected by EARL, instead of one per each application. This table provides internal details of running applications and could significantly increase the DB size.</li>
<li><b>Signatures</b>: EARL computed signature and metrics. One record per JOBID.STEPID.NODENAME is created in the DB when the application is executed with EARL.</li>
<li><b>GPU_signatures</b>: EARL computed GPU signatures. This information belongs to a loop or application signature. If the signature is from a node with 4 GPUs there will be 4 records.</li>
<li><b>Power_signatures</b>: Basic time and power metrics that can be obtained without EARL. Reported for all applications. One record per JOBID.STEPID.NODENAME is created in the DB.</li>
</ul>
<h3>System monitoring</h3>
<p>This tables contain periodic information gathered from the nodes. There is a single-node information table and an aggregated one to increase the speed of queries to get cluster-wide information.</p>
<ul>
<li><b>Periodic_metrics</b>: node metrics reported every N seconds (N is defined in <code>ear.conf</code>).</li>
<li><b>Periodic_aggregations</b>: sum of all <em>Periodic_metrics</em> in a time period to ease accounting in <code>ereport</code> command and EARGM, as well as reducing database size (<em>Periodic_metrics</em> of older periods where precision at node level is not needed can be deleted and the aggregations can be used instead).</li>
</ul>
<h3>Events</h3>
<ul>
<li><b>Events</b>: EAR events report. There are several types of events, depending on their source: EARL, EARD-powercap, EARD-runtime and EARGM. For more information, see the <a href="../../EAR-database-table-descriptions#events">table's fields</a> and its header file (src/common/types/event_type.h). For EARL-specific events, also see <a href="../../EAR-environment-variables#report_earl_events">this</a>.</li>
</ul>
<h3>EARGM reports</h3>
<ul>
<li><b>Global_energy</b>: contains reports of cluster-wide energy accounting set by EARGM using the parameters in <code>ear.conf</code>. One record every T1 period (defined at ear.conf) is reported.</li>
</ul>
<h3>Learning phase</h3>
<p>This tables are the same as their non-learning counterparts, but are specifically used to store the applications executed during a learning phase.</p>
<ul>
<li><b>Learning_applications</b>: same as <em>Applications</em>, restricted to learning phase applications.</li>
<li><b>Learning_jobs</b>: same as <em>Jobs</em>, restricted to learning phase jobs.</li>
<li><b>Learning_signatures</b>: same as <em>Signatures</em>, restricted to learning phase job metrics.</li>
</ul>
<blockquote class="doxtable">
<p><b>NOTE</b> In order to have <em>GPU_signatures</em> table created and <em>Periodic_metrics</em> containing GPU data, the databasease must be created (if you follow the <code>edb_create</code> approach, see the section down below) with GPUs enabled at the compilation time. See <a href="../../#updating-from-previous-versions">how to update from previous versions</a> if you are updating EAR from a release not having GPU metrics. </p>
</blockquote>
<p>To create the database a command (<code>edb_create</code>) is provided by EAR, which can either create the database directly or provide the queries for the database creation so the administrator can use them or modify them at their discretion (any changes may alter the correct function of EAR's accounting).</p>
<p>Since a lot of data is reported by EAR to the database, EAR provides two commands to remove old data and free up space. These are intended to be used with a <code>cron</code> job or a similar tool, but they can also be run manually without any issues. The two tools are <code>edb_clean_pm</code> to remove periodic data accounting from nodes, and <code>edb_clean_apps</code> to remove all the data related to old jobs.</p>
<p>For more information on this commands, check the <a href="../../EAR-commands#database-commands">commands' page on the wiki</a></p>
<p>When running <code>edb_create</code> some tables might not be created, or may have some quirks, depending on some <code>ear.conf</code> settings. The settings and alterations are as follows:</p>
<ul>
<li><code>DBReportNodeDetail</code>: if set to 1, <code>edb_create</code> will create two additional columns in the <em>Periodic_metrics</em> table for Temperature (in Celsius) and Frequency (in Hz) accounting.</li>
<li><code>DBReportSigDetail</code>: if set to 1, <em>Signatures</em> will have additional fields for cycles, instructions, and FLOPS1-8 counters (number of instruction by type).</li>
<li><code>DBMaxConnections</code>: this will restrict the number of maximum simultaneous commands connections.</li>
</ul>
<p>If any of the settings is set to 0, the table will have fewer details but the table's records will be smaller in stored size.</p>
<p>Any table with missing columns can be later altered by the admin to include said columns. For a full detail of each table's columns, run <code>edb_create -o</code> with the desired <code>ear.conf</code> settings.</p>
<p>There are various settings in <code>ear.conf</code> that restrict data reported to the database and some errors might occur if the database configuration is different from EARDB's.</p>
<ul>
<li><code>DBReportNodeDetail</code>: if set to 1, node managers will report temperature, average frequency, DRAM and PCK energy to the database manager, which will try to insert it to <em>Periodic_metrics</em>. If <em>Periodic_metrics</em> does not have the columns for both metrics, an error will occur and nothing will be inserted. To solve the error, set <code>ReportNodeDetail</code> to 0 or manually update <em>Periodic_metrics</em> in order to have the necessary columns.</li>
<li><code>DBReportSigDetail</code>: similarly to <code>ReportNodeDetail</code>, an error will occur if the configuration differs from the one used when creating the database.</li>
<li><code>DBReportLoops</code> : if set to 1, EARL detected application loops will be reported to the database, each with its corresponding Signature. Set to 0 to disable this feature. Regardless of the setting, no error should occur.</li>
</ul>
<p>If <em>Signatures</em> and/or <em>Periodic_metrics</em> have additional columns but their respective settings are set to 0, a NULL will be set in those additional columns, which will make those rows smaller in size (but bigger than if the columns did not exist).</p>
<p>Additionally, if EAR was compiled in a system with GPUs (or with the GPU flag manually enabled), another table to store GPU data will be created.</p>
<div class="image">
<img src="../.././images/GPU_DB_diagram.png"/>
</div>
<blockquote class="doxtable">
<p><b>NOTE</b> the nomenclature is modified from MySQL's type. Any type starting with <code>u</code> is unsigned. <code>bigint</code> corresponds to an integer of 64 bits, <code>int</code> is 32 and <code>smallint</code> is 16.</p>
<p>For a detailed description of each field in any of the database's tables, see [here](EAR-database-table-descriptions). </p>
</blockquote>
<h3>From EAR 4.2 to 4.3</h3>
<blockquote class="doxtable">
<p><b>NOTE</b> This change only applies to the databases that have been created with the extended application signature (i.e. they have the FLOPS, instructions and cycles counters in their signatures). </p>
</blockquote>
<p>Three new fields corresponding to L1, L2 and L3 cache misses have been added to the signatures. </p><div class="fragment"><div class="line">ALTER TABLE Signatures</div><div class="line">ADD COLUMN L1_misses BIGINT UNSIGNED AFTER perc_MPI,</div><div class="line">ADD COLUMN L2_misses BIGINT UNSIGNED AFTER L1_misses,</div><div class="line">ADD COLUMN L3_misses BIGINT UNSIGNED AFTER L2_misses;</div></div><!-- fragment --> <div class="fragment"><div class="line">ALTER TABLE Learning_signatures</div><div class="line">ADD COLUMN L1_misses BIGINT UNSIGNED AFTER perc_MPI,</div><div class="line">ADD COLUMN L2_misses BIGINT UNSIGNED AFTER L1_misses,</div><div class="line">ADD COLUMN L3_misses BIGINT UNSIGNED AFTER L2_misses;</div></div><!-- fragment --> <h3>From EAR 4.1 to 4.2</h3>
<p>A field in the Events table had its name changed to be more generic. One can do that with EITHER of the following commands:</p>
<div class="fragment"><div class="line">ALTER TABLE Events RENAME COLUMN freq TO value;</div></div><!-- fragment --><div class="fragment"><div class="line">ALTER TABLE Events CHANGE freq value INT unsigned;</div></div><!-- fragment --><p>Furthermore, some errors on big servers have been found due to the ids of a few fields being too small. To correct this, please run the following commands:</p>
<div class="fragment"><div class="line">ALTER TABLE Learning_signatures MODIFY COLUMN id BIGINT unsigned AUTO_INCREMENT;</div><div class="line">ALTER TABLE Signatures MODIFY COLUMN id BIGINT unsigned AUTO_INCREMENT;</div><div class="line">ALTER TABLE Applications MODIFY COLUMN signature_id BIGINT unsigned;</div><div class="line">ALTER TABLE Loops MODIFY COLUMN signature_id BIGINT unsigned;</div></div><!-- fragment --><p>If GPUs are being used, also run:</p>
<div class="fragment"><div class="line">ALTER TABLE GPU_signatures MODIFY COLUMN id BIGINT unsigned AUTO_INCREMENT;</div><div class="line">ALTER TABLE Learning_signatures MODIFY COLUMN min_gpu_sig_id BIGINT unsigned;</div><div class="line">ALTER TABLE Learning_signatures MODIFY COLUMN max_gpu_sig_id BIGINT unsigned;</div><div class="line">ALTER TABLE Signatures MODIFY COLUMN min_gpu_sig_id BIGINT unsigned;</div><div class="line">ALTER TABLE Signatures MODIFY COLUMN max_gpu_sig_id BIGINT unsigned;</div></div><!-- fragment --><h3>From EAR 3.4 to 4.0</h3>
<p>Several fields have to be added in this update. To do so, run the following commands to the database's CLI client:</p>
<div class="fragment"><div class="line">ALTER TABLE Signatures ADD COLUMN avg_imc_f INT unsigned AFTER avg_f;</div><div class="line">ALTER TABLE Signatures ADD COLUMN perc_MPI FLOAT AFTER time;</div><div class="line">ALTER TABLE Signatures ADD COLUMN IO_MBS FLOAT AFTER GBS;</div><div class="line"></div><div class="line">ALTER TABLE Learning_signatures ADD COLUMN avg_imc_f INT unsigned AFTER avg_f;</div><div class="line">ALTER TABLE Learning_signatures ADD COLUMN perc_MPI FLOAT AFTER time;</div><div class="line">ALTER TABLE Learning_signatures ADD COLUMN IO_MBS FLOAT AFTER GBS;</div></div><!-- fragment --><h3>From EAR 3.3 to 3.4</h3>
<p>If no GPUs were used and they will not be used there are no changes necessary.</p>
<p>If GPUs were being used, type the following commands to the database's CLI client:</p>
<div class="fragment"><div class="line">ALTER TABLE Signatures ADD COLUMN min_GPU_sig_id BIGINT unsigned, ADD COLUMN max_GPU_sig_id BIGINT unsigned;  </div><div class="line">ALTER TABLE Learning_signatures ADD COLUMN min_GPU_sig_id BIGINT unsigned, ADD COLUMN max_GPU_sig_id BIGINT unsigned;  </div><div class="line">CREATE TABLE IF NOT EXISTS GPU_signatures ( id BIGINT unsigned NOT NULL AUTO_INCREMENT, GPU_power FLOAT NOT NULL, GPU_freq INT unsigned NOT NULL, GPU_mem_freq INT unsigned NOT NULL, GPU_util INT unsigned NOT NULL, GPU_mem_util INT unsigned NOT NULL, PRIMARY KEY (id));</div></div><!-- fragment --><p>If no GPUs were being used but now are present, use the previous query plus the following one:</p>
<div class="fragment"><div class="line">ALTER TABLE Periodic_metrics ADD COLUMN GPU_energy INT;</div></div><!-- fragment --> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.14
</small></address>
</body>
</html>
